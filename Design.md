# Design

低地球轨道 (LEO) 卫星网络凭借其低延迟和广覆盖的优势，成为未来全球通信的关键基础设施。然而，卫星的高速移动导致网络拓扑频繁剧烈变化，为高效、稳定的路由带来了巨大挑战。传统的路由协议（如链路状态或距离矢量）难以适应这种动态性，计算开销巨大且收敛速度慢。为了解决这些问题，本文提出了一种新型的**分层式、强化学习(RL)驱动的动态路由机制**。该机制利用中地球轨道 (MEO) 卫星作为管理节点和智能决策中心，为 LEO 卫星提供高效、自适应的路由服务。

## 系统架构概述

我们的路由架构采用**双层管理模型**，核心思想是利用相对静止的 MEO 卫星来管理和辅助高度动态的 LEO 卫星层进行路由决策。具体架构如下：

1. **LEO 卫星层：** 负责感知链路状态、与地面站通信、数据包转发。每个 LEO 卫星配备基本的路由表维护和邻居发现机制。
2. **MEO 管理卫星层：** 负责路由策略的生成与优化。每个 MEO 卫星被分配管理一个特定子集（区域）的 LEO 卫星（称为其**管理域**）。MEO 卫星上部署**多智能体强化学习 (Multi-Agent Reinforcement Learning, MARL)** 模型，作为路由策略的“大脑”。
3. **管理关系建立：** 在初始化阶段或根据卫星位置动态调整，每个 LEO 卫星被**唯一分配**给一个 MEO 卫星作为其**管理卫星 (Managing MEO)**。这种分配通常基于地理位置或覆盖区域。

## 路由机制

路由过程的核心流程如下：

1. **路由请求发起 (LEO):**

   - 源 LEO 卫星 `L_src` 向**其管理 MEO (`M1`)** 发送路由请求 (包含 `L_src`, `L_dest`)。

2. **初始路由决策 (MEO):**

   - `M1` 计算初始路径 `[L_src, L_hop1, ..., L_dest]`。
   - **创建 MEO 列表：** 生成路由包头，其中 **`MEO_ID_List = [M1]`**。

3. **数据包转发与修复触发 (LEO):**

   - 当中间节点 `L_cur` 发现下一跳失效：
     - 向**自身当前管理 MEO (`M_cur_mng`)** 发送修复请求，**携带当前包头中的完整 `MEO_ID_List`**。

4. **路由修复决策 (MEO):**

   - **当前 MEO (`M_cur_mng`)** 收到请求：
     - 计算新路径 `[L_cur, L_newhop, ..., L_dest]`
     - **更新 MEO 列表：** 将自身 ID **追加**到 `MEO_ID_List` 末尾 → `MEO_ID_List' = [M1, ..., M_cur_mng]`
     - 下发新路径和更新后的 `MEO_ID_List'` 给 `L_cur`
     - **路由修复通知：** 向 **`MEO_ID_List` 的最后一个元素（即上一决策MEO）** 发送 **修复触发通知**

5. **修复触发通知处理 (上一决策MEO):**

   - 当 MEO `M_prev`（列表中的上一决策者）收到通知：
     - 在强化学习更新时施加 **负奖励惩罚**
     - 通知包含：触发位置、时间戳、包标识符

6. **路径终结与协作奖励 (LEO & MEO):**

   - 当 `L_dest` 成功接收包：
     - **向 `MEO_ID_List` 中所有 MEO** 发送 **成功递交通知**
     - 通知包含：总延迟、总跳数、修复次数、完整路径记录

7. **强化学习模型更新 (协作式奖励):**

   - **所有参与决策的 MEO 同步更新：**

     ```python
     # 伪代码：每个MEO的奖励计算
     if 收到成功通知:
         reward = +R_success * 成功奖励基值
                 -α * Total_Delay  # 延迟惩罚
                 -β * Total_Hops    # 跳数惩罚
                 -δ * Repair_Count  # 修复次数惩罚
         
     if 收到修复触发通知 (仅上一决策MEO):
         reward += -γ * Repair_Penalty  # 失效直接惩罚
     ```

   - **学习目标：**

     - 所有MEO共同优化端到端性能（延迟/跳数）
     - 决策MEO避免产生脆弱路径（减少后续修复）
     - 修复MEO提供高效恢复路径（减少总修复次数）

   ## 跨域路由处理

   由于源 LEO 卫星和目标 LEO 卫星可能分别由不同的 MEO 卫星管理，因此存在跨域路由的需求。跨域路由的设计如下：

   1. **边缘 MEO 卫星选择**：根据源 LEO 卫星和目标 LEO 卫星的地理位置，智能地选择一个边缘 MEO 卫星作为中转节点。
   2. **路径更新与标记**：源 LEO 卫星向边缘 MEO 卫星发送数据包，并标记为跨域包。包在经过边缘 MEO 卫星时，强制进行一次路由修复。
   3. **跨域路径转发**：通过重新计算跨域路径，确保数据包能够通过最优路径到达目标 LEO 卫星。

   